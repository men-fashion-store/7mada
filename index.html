<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ROSSIA - Smart Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* --- Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ --- */
            --bg-main: #fcf9f2;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #3e2723;
            --text-secondary: #795548;
            --accent-color: #6d4c41;
            --price-color: #2e7d32;
            --line-color: #ece0d1;
            --input-bg: #fffbf7;
            --watermark-color: %233e2723;
            --watermark-opacity: 0.08;
        }

        [data-theme="dark"] {
            /* --- Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ --- */
            --bg-main: #000000;
            --card-bg: rgba(18, 18, 18, 0.95);
            --text-primary: #ffffff;
            --text-secondary: #bcaaa4;
            --accent-color: #d7ccc8;
            --price-color: #81c784;
            --line-color: #333333;
            --input-bg: #1e1e1e;
            --watermark-color: %23ffffff;
            --watermark-opacity: 0.1;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-primary);
            margin: 0;
            padding: 20px 20px 100px 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400' viewBox='0 0 400 400'%3E%3Cg fill='var(--watermark-color)' opacity='var(--watermark-opacity)'%3E%3Ctext x='200' y='200' font-family='serif' font-weight='900' font-size='60' text-anchor='middle' dominant-baseline='middle' transform='rotate(-10 200 200)'%3EROSSIA%3C/text%3E%3Cpath d='M200 50 A 150 150 0 1 0 200 350 A 150 150 0 1 0 200 50 Z M 200 60 A 140 140 0 1 1 200 340 A 140 140 0 1 1 200 60 Z' fill-opacity='0.5'/%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            background-size: 500px auto;
        }
        
        [data-theme="light"] body { --watermark-color: %233e2723; }
        [data-theme="dark"] body { --watermark-color: %23ffffff; }

        /* --- Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ --- */
        .theme-switch-wrapper { position: absolute; top: 20px; left: 20px; z-index: 100; }
        .theme-switch { display: inline-block; height: 30px; position: relative; width: 55px; }
        .theme-switch input { display:none; }
        .slider { background-color: var(--line-color); bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 34px; border: 1px solid var(--text-secondary); }
        .slider:before { background-color: var(--text-primary); bottom: 3px; content: ""; height: 22px; left: 4px; position: absolute; transition: .4s; width: 22px; border-radius: 50%; }
        input:checked + .slider:before { transform: translateX(24px); background-color: #fff; }
        .slider .icon { position: absolute; top: 50%; transform: translateY(-50%); font-size: 14px; transition: opacity 0.3s; }
        .slider .sun { left: 7px; opacity: 1; color: #f39c12; }
        .slider .moon { right: 7px; opacity: 0; color: #fff; }
        input:checked + .slider .sun { opacity: 0; }
        input:checked + .slider .moon { opacity: 1; }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
        .header-container { margin-top: 40px; margin-bottom: 30px; text-align: center; animation: fadeIn 1s ease; position: relative; z-index: 2; }
        .logo-wrapper { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .main-logo-text { font-size: 50px; font-weight: 900; color: var(--text-primary); letter-spacing: -1px; text-transform: uppercase; }
        .cup-icon { width: 45px; height: 45px; fill: var(--text-primary); }
        .logo-sub { font-size: 13px; font-weight: 700; color: var(--text-secondary); letter-spacing: 4px; margin-top: 5px; }

        /* --- Ø§Ù„ÙƒØ±ÙˆØª --- */
        .notebook { width: 100%; max-width: 600px; position: relative; z-index: 2; }
        .person-card {
            background: var(--card-bg); border: 1px solid var(--line-color);
            border-radius: 12px; padding: 15px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative;
            backdrop-filter: blur(5px);
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--line-color); padding-bottom: 10px; margin-bottom: 10px; }
        .name-input { border: none; background: transparent; font-size: 18px; font-weight: 800; color: var(--text-primary); width: 100%; outline: none; font-family: 'Cairo'; }
        .delete-btn { background: none; border: 1px solid var(--line-color); color: var(--text-secondary); width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .delete-btn:hover { background: #ff5252; color: #fff; border-color: #ff5252; }

        /* --- ØµÙÙˆÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª --- */
        .item-row { display: flex; gap: 5px; margin-bottom: 8px; align-items: center; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        .item-input {
            border: 1px solid var(--line-color); background: var(--input-bg);
            color: var(--text-primary); padding: 8px; border-radius: 6px;
            font-family: 'Cairo'; font-size: 14px; outline: none; font-weight: 600; text-align: center;
        }
        
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        select.item-input {
            appearance: none; -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236d4c41%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: left 0.7rem top 50%;
            background-size: 0.65rem auto;
            padding-left: 20px;
        }

        .i-qty { width: 15%; font-weight: 800; }
        .i-name { width: 45%; text-align: right; padding-right: 10px; cursor: pointer; }
        .i-price { width: 20%; background: rgba(0,0,0,0.03); } /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ù„Ø£Ù†Ù‡ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ */
        .i-total { width: 15%; font-size: 14px; font-weight: 900; color: var(--price-color); text-align: center; }
        
        .i-remove { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 18px; width: 5%; }
        .i-remove:hover { color: #ff5252; }

        .card-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 10px; border-top: 1px dashed var(--line-color); }
        .add-item-btn {
            background: var(--text-primary); color: var(--bg-main); border: none;
            padding: 8px 20px; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; font-family: 'Cairo';
        }
        .card-total { font-size: 14px; color: var(--text-secondary); font-weight: 700; }
        .card-total span { color: var(--text-primary); font-size: 18px; font-weight: 900; }

        /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© --- */
        .fab-container {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 20px; z-index: 90;
        }
        .main-fab {
            width: 60px; height: 60px; background: var(--text-primary); color: var(--bg-main);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); cursor: pointer;
            border: 2px solid var(--bg-main); transition: transform 0.2s;
        }
        .main-fab:hover { transform: scale(1.1); }
        
        /* Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ± */
        .report-fab { background: var(--accent-color); font-size: 24px; }

        .total-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: var(--text-primary); color: var(--bg-main);
            width: 90%; max-width: 400px; padding: 15px 25px; border-radius: 50px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 100;
        }
        .total-val { font-size: 24px; font-weight: 900; }

    </style>
</head>
<body data-theme="light">

    <div class="theme-switch-wrapper">
       <label class="theme-switch">
        <input type="checkbox" id="themeCheckbox" />
        <div class="slider">
            <span class="icon sun">â˜€</span>
            <span class="icon moon">â˜¾</span>
        </div>
      </label>
    </div>

    <div id="app-content" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        
        <div class="header-container">
            <div class="logo-wrapper">
                <svg class="cup-icon" viewBox="0 0 24 24"><path d="M18.5 3H6c-1.1 0-2 .9-2 2v5.71c0 3.83 2.95 7.18 6.78 7.29 3.96.12 7.22-3.06 7.22-7v-1h.5c1.93 0 3.5-1.57 3.5-3.5S20.43 3 18.5 3zM16 8.99c0 2.8-2.2 5.02-5 5.02s-5-2.21-5-5.02V5h10v3.99zM18.5 8h-.5V5h.5c.83 0 1.5.67 1.5 1.5S19.33 8 18.5 8z" /></svg>
                <div class="main-logo-text">ROSSIA</div>
            </div>
            <div class="logo-sub">SMART MENU SYSTEM</div>
        </div>

        <div class="notebook">
            <div id="users-container"></div>
        </div>

        <div class="fab-container">
            <button onclick="showReport()" class="main-fab report-fab" title="Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª">ğŸ“Š</button>
            <button onclick="addNewUser()" class="main-fab" title="Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯">+</button>
        </div>

        <div class="total-bar">
            <div>
                <div style="font-size:12px; opacity:0.8;">Grand Total</div>
                <div style="font-size:10px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</div>
            </div>
            <div style="display:flex; align-items:baseline; gap:5px;">
                <span id="grand-total" class="total-val">0</span>
                <span style="font-size:12px; color:var(--accent-color);">EGP</span>
            </div>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // ==========================================
        // ğŸ› ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ÙŠÙˆ (Ø¹Ø¯Ù„ Ù‡Ù†Ø§ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡)
        // ==========================================
        const MENU_ITEMS = [
            { name: "Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ", price: 20 },
            { name: "Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ", price: 30 },
            { name: "Ø¥Ø³Ø¨Ø±ÙŠØ³Ùˆ", price: 30 },
            { name: "Ø´Ø§ÙŠ", price: 10 },
              { name: " ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ Ø¨Ø§Ù„Ù„Ø¨Ù†", price: 30 },
            { name: "ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³", price: 20 },
            { name: "ÙƒÙˆÙ„Ø§", price: 20 },
            { name: "Ù…ÙŠØ§Ù‡ Ù…Ø¹Ø¯Ù†ÙŠØ©", price: 10 },
            { name: " Ø¹ØµÙŠØ± Ø¨ÙŠØªÙŠ", price: 15 },
             { name: "Ø¹ØµÙŠØ± ÙÙˆØ§ÙƒÙ‡", price: 25 },
             { name: "Ø±Ø§Ù†ÙŠ", price: 35 },
             { name: "Ø§Ù†Ø¯ÙˆÙ…ÙŠ", price: 20 },
             { name: "ÙƒÙˆÙƒØªÙŠÙ„", price: 35 }
        ]

        const firebaseConfig = {
            apiKey: "AIzaSyBdONnA1oD-7urCeAK99l5i3WVGkit7OK8",
            authDomain: "rossia-eebc7.firebaseapp.com",
            databaseURL: "https://rossia-eebc7-default-rtdb.firebaseio.com",
            projectId: "rossia-eebc7",
            storageBucket: "rossia-eebc7.firebasestorage.app",
            messagingSenderId: "926867373358",
            appId: "1:926867373358:web:7cdad5ea5e5bdfd34b4ebf",
            measurementId: "G-Y09FGPTZ1W"
        };

        let db;
        let globalData = {}; // Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø´Ø§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ±

        // Theme Setup
        const toggleSwitch = document.getElementById('themeCheckbox');
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme) {
            document.body.setAttribute('data-theme', currentTheme);
            toggleSwitch.checked = currentTheme === 'dark';
        }
        toggleSwitch.addEventListener('change', function(e) {
            const theme = e.target.checked ? 'dark' : 'light';
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        });

        window.onload = function() {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                // Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ orders_v3 Ù„Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
                db.ref('orders_v3').on('value', renderAll);
            }
        };

        function renderAll(snapshot) {
            globalData = snapshot.val() || {}; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
            const container = document.getElementById('users-container');
            let grandTotal = 0;

            if (!globalData || Object.keys(globalData).length === 0) {
                container.innerHTML = "<p style='text-align:center; opacity:0.5; margin-top:50px;'>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©</p>";
                document.getElementById('grand-total').innerText = "0";
                return;
            }

            const existingIds = new Set();
            
            Object.keys(globalData).forEach(userId => {
                existingIds.add(`card-${userId}`);
                const user = globalData[userId];
                
                let userTotal = 0;
                if(user.items) {
                    Object.values(user.items).forEach(i => {
                        userTotal += (Number(i.qty||1) * Number(i.price||0));
                    });
                }
                grandTotal += userTotal;

                let card = document.getElementById(`card-${userId}`);
                if (!card) {
                    card = document.createElement('div');
                    card.id = `card-${userId}`;
                    card.className = 'person-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <input type="text" id="name-${userId}" class="name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„.." oninput="updName('${userId}', this.value)">
                            <button class="delete-btn" onclick="delUser('${userId}')">Ã—</button>
                        </div>
                        <div id="items-${userId}"></div>
                        <div class="card-actions">
                            <button class="add-item-btn" onclick="addItem('${userId}')">Ø¥Ø¶Ø§ÙØ© +</button>
                            <div class="card-total"><span>${userTotal}</span> Ø¬.Ù…</div>
                        </div>
                    `;
                    container.appendChild(card);
                    if(container.querySelector('p')) container.querySelector('p').remove();
                }

                const nameInp = document.getElementById(`name-${userId}`);
                if(document.activeElement !== nameInp) nameInp.value = user.name || "";
                
                card.querySelector('.card-total span').innerText = userTotal;

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙÙˆÙ
                const itemsContainer = document.getElementById(`items-${userId}`);
                const itemsData = user.items || {};
                const currentItemIds = new Set();

                Object.keys(itemsData).forEach(itemId => {
                    currentItemIds.add(`item-${itemId}`);
                    const item = itemsData[itemId];
                    const qtyVal = item.qty || 1;
                    const priceVal = item.price || 0;
                    const lineTotal = qtyVal * priceVal;

                    let row = document.getElementById(`item-${itemId}`);
                    if(!row) {
                        row = document.createElement('div');
                        row.id = `item-${itemId}`;
                        row.className = 'item-row';
                        
                        // Ø¥Ù†Ø´Ø§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        let options = `<option value="" disabled ${!item.text ? 'selected' : ''}>Ø§Ø®ØªØ±..</option>`;
                        MENU_ITEMS.forEach(m => {
                            // Ù„Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø­ÙÙˆØ¸ ÙˆØ³Ø¹Ø±Ù‡ Ø§ØªØºÙŠØ± ÙÙŠ Ø§Ù„Ù…Ù†ÙŠÙˆØŒ ÙŠÙØ¶Ù„ Ù…Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø³Ø¹Ø±Ù‡ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ù„Ø§ Ù„Ùˆ Ø§Ø®ØªØ±Ù†Ø§Ù‡ ØªØ§Ù†ÙŠ
                            options += `<option value="${m.price}" ${item.text === m.name ? 'selected' : ''}>${m.name}</option>`;
                        });

                        row.innerHTML = `
                            <input type="number" class="item-input i-qty" id="q-${itemId}" value="${qtyVal}" oninput="updateRowCalc('${userId}','${itemId}')">
                            
                            <select class="item-input i-name" id="n-${itemId}" onchange="updateRowMenu('${userId}','${itemId}', this)">
                                ${options}
                            </select>

                            <input type="number" class="item-input i-price" id="p-${itemId}" value="${priceVal}" readonly>
                            <div class="i-total" id="t-${itemId}">${lineTotal}</div>
                            <button class="i-remove" onclick="delItem('${userId}','${itemId}')">Ã—</button>
                        `;
                        itemsContainer.appendChild(row);
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… ÙÙ‚Ø· Ù„Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø´ Ù‡Ùˆ Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠÙ‡ Ø§Ù„ØªØ±ÙƒÙŠØ²
                    const qInp = document.getElementById(`q-${itemId}`);
                    const nInp = document.getElementById(`n-${itemId}`); // Select
                    const pInp = document.getElementById(`p-${itemId}`);
                    const tDiv = document.getElementById(`t-${itemId}`);

                    if(document.activeElement !== qInp) qInp.value = qtyVal;
                    // Select value update handled by HTML regeneration slightly, but to be safe:
                    // We rely on the 'selected' attribute in innerHTML above for the text matching.
                    
                    if(document.activeElement !== pInp) pInp.value = priceVal;
                    tDiv.innerText = lineTotal;
                });

                Array.from(itemsContainer.children).forEach(child => {
                    if(!currentItemIds.has(child.id)) child.remove();
                });
            });

            Array.from(container.children).forEach(child => {
                if(child.className === 'person-card' && !existingIds.has(child.id)) child.remove();
            });

            animateValue("grand-total", parseInt(document.getElementById("grand-total").innerText), grandTotal, 500);
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ---

        // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙ†Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function updateRowMenu(uid, iid, selectElem) {
            const price = selectElem.value; // Ø§Ù„Ø³Ø¹Ø± Ø¬Ø§ÙŠ Ù…Ù† Ø§Ù„Ù€ value
            const text = selectElem.options[selectElem.selectedIndex].text; // Ø§Ù„Ø§Ø³Ù…
            
            // Ù†Ø­Ø¯Ø« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            db.ref(`orders_v3/${uid}/items/${iid}`).update({
                text: text,
                price: Number(price)
            });
        }

        // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ© (Ø§Ù„Ø³Ø¹Ø± Ø«Ø§Ø¨Øª)
        function updateRowCalc(uid, iid) {
            const qty = document.getElementById(`q-${iid}`).value;
            db.ref(`orders_v3/${uid}/items/${iid}`).update({
                qty: Number(qty)
            });
        }

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ø§Ù„Ø¬Ø±Ø¯)
        function showReport() {
            if (!globalData) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª");

            let report = {};
            let totalCash = 0;

            Object.values(globalData).forEach(user => {
                if(user.items) {
                    Object.values(user.items).forEach(item => {
                        if(item.text) { // Ù„Ùˆ Ø§Ù„ØµÙ†Ù Ù„Ù‡ Ø§Ø³Ù…
                            if(!report[item.text]) report[item.text] = 0;
                            report[item.text] += Number(item.qty || 1);
                            totalCash += (Number(item.qty||1) * Number(item.price||0));
                        }
                    });
                }
            });

            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            let msg = "ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ:\n\n";
            Object.keys(report).forEach(itemName => {
                msg += `â–«ï¸ ${itemName}: ${report[itemName]}\n`;
            });
            msg += "\nğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯: " + totalCash + " Ø¬Ù†ÙŠÙ‡";

            alert(msg);
        }

        // Firebase Basics
        const updName = (uid, val) => db.ref(`orders_v3/${uid}`).update({name: val});
        const addNewUser = () => db.ref('orders_v3').push().set({name:"", items:{}});
        const delUser = (uid) => confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ") ? db.ref(`orders_v3/${uid}`).remove() : null;
        const addItem = (uid) => db.ref(`orders_v3/${uid}/items`).push().set({qty:1, text:"", price:0});
        const delItem = (uid, iid) => db.ref(`orders_v3/${uid}/items/${iid}`).remove();

        function animateValue(id, start, end, duration) {
            if (start === end) return;
            const obj = document.getElementById(id);
            const range = end - start;
            let current = start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            const timer = setInterval(function() {
                current += increment;
                obj.innerText = current;
                if (current == end) clearInterval(timer);
            }, Math.max(stepTime, 10));
        }
    </script>
</body>
</html>
